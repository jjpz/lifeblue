const form=document.querySelector("form"),questions=Array.from(document.querySelectorAll(".question")),date=new Date,year=date.getFullYear(),month=date.getMonth()+1<10?`0${date.getMonth()+1}`:date.getMonth()+1,day=date.getDate()+1<10?`0${date.getDate()+1}`:date.getDate()+1,minDate=`${year}-${month}-${day}`,dateInput=document.querySelector('input[name="date"]');dateInput.setAttribute("min",minDate),document.querySelector(".footer-year").innerHTML=year;const startButton=document.querySelector(".btn-start"),prevButton=document.querySelector(".btn-prev"),nextButton=document.querySelector(".btn-next"),submitButton=document.querySelector(".btn-submit"),startOverButton=document.querySelector(".btn-restart"),progress=document.querySelector("#progress"),progressBar=progress.querySelector("#progress-bar"),progressValue=progress.querySelector("#progress-value");let counter,finalData,formData=localStorage.getItem("data")?JSON.parse(localStorage.getItem("data")):[];updateProgress=e=>{e>-1&&progress.classList.remove("hidden");let t=e/10*100;progressBar.style.width=`${t}%`,progressValue.innerHTML=`${t}%`,progressBar.setAttribute("aria-valuenow",t)},showSummary=e=>{let t="";e.forEach((e=>{"radio"===e.type&&(t+=`\n                <section class="summary-section radio-group">\n                    <div>Class frequency:</div>\n                    <div>\n                        <label for="single">\n                            <input type="radio" id="single" name="ffrequency" value="single" ${"single"===e.value?"checked":""}>\n                            <span>Single</span>\n                        </label>\n                    </div>\n                    <div>\n                        <label for="monthly">\n                            <input type="radio" id="monthly" name="ffrequency" value="monthly" ${"monthly"===e.value?"checked":""}>\n                            <span>Monthly</span>\n                        </label>\n                    </div>\n                </section>\n            `),"select"===e.type&&(t+=`\n            <section class="summary-section select-group">\n                <div>Class type:</div>\n                <select id="class" name="class" class="form-element">\n                    <option value="">Please select an option</option>\n                    <option value="infant" ${"infant"===e.value?"selected":""}>Infant Yoga</option>\n                    <option value="baby" ${"baby"===e.value?"selected":""}>Baby Yoga</option>\n                    <option value="kids" ${"kids"===e.value?"selected":""}>Kids Yoga</option>\n                </select>\n            </section>\n            `),"date"===e.type&&(t+=`\n            <section class="summary-section">\n                <div>Date:</div>\n                <div><input type="date" id="date" name="date" min="${minDate}" value="${e.value}" class="form-element"></div>\n            </section>\n            `),"email"===e.type&&(t+=`\n            <section class="summary-section">\n                <div>Email:</div>\n                <div><input type="email" id="email" name="email" value="${e.value}" class="form-element"></div>\n            </section>\n            `),"tel"===e.type&&(t+=`\n            <section class="summary-section">\n                <div>Phone:</div>\n                <div><input type="tel" id="tel" name="tel" value="${e.value}" class="form-element"></div>\n            </section>\n            `),"number"===e.type&&(t+=`\n            <section class="summary-section">\n                <div>Child's age:</div>\n                <div><input type="number" id="age" name="age" min="1" max="12" value="${e.value}" class="form-element"></div>\n            </section>\n            `),"text"===e.type&&(t+='<section class="summary-section">',"name"===e.name&&(t+="<div>Child's name:</div>"),"parent"===e.name&&(t+="<div>Parent's name:</div>"),"event"===e.name&&(t+="<div>Event:</div>"),"info"===e.name&&(t+="<div>Additional info:</div>"),t+=`<div><input type="text" id="${e.name}" name="${e.name}" value="${e.value}" class="form-element"></div></section>\n            `)})),document.getElementById("summary").innerHTML=`\n        <h2>Summary</h2>\n        ${t}\n    `},showQuestion=e=>{startButton.classList.add("hidden"),questions[e].classList.add("active"),0===e?prevButton.classList.add("hidden"):prevButton.classList.remove("hidden"),nextButton.classList.remove("hidden"),e===questions.length-1?(showSummary(formData),prevButton.classList.add("hidden"),nextButton.classList.add("hidden"),submitButton.classList.remove("hidden")):(nextButton.classList.remove("hidden"),submitButton.classList.add("hidden")),updateProgress(e)},formData.length>0?(startButton.classList.add("hidden"),counter=formData.length,showQuestion(counter),formData.forEach((e=>{"radio"===e.type?questions[e.question].querySelector(`[value="${e.value}"]`).checked=!0:questions[e.question].querySelector(".form-element").value=e.value}))):counter=-1,showSubmission=e=>{let t="";e.forEach((e=>{"radio"===e.type&&(t+=`<section class="summary-section">Class frequency: ${e.value}</section>`),"select"===e.type&&(t+=`<section class="summary-section">Class type: ${e.value}</section>`),"date"===e.type&&(t+=`<section class="summary-section">Date: ${e.value}</section>`),"email"===e.type&&(t+=`<section class="summary-section">Email: ${e.value}</section>`),"tel"===e.type&&(t+=`<section class="summary-section">Phone: ${e.value}</section>`),"number"===e.type&&(t+=`<section class="summary-section">Child's age: ${e.value}</section>`),"text"===e.type&&("name"===e.name&&(t+=`<section class="summary-section">Child's name: ${e.value}</section>`),"parent"===e.name&&(t+=`<section class="summary-section">Parent's name: ${e.value}</section>`),"event"===e.name&&(t+=`<section class="summary-section">Event: ${e.value}</section>`),"info"===e.name&&(t+=`<section class="summary-section">Additional info: ${e.value}</section>`))})),document.getElementById("summary").innerHTML=`\n        <h2>Your information has been submitted!</h2>\n        ${t}\n    `},prevQuestion=e=>{questions[e].classList.remove("active"),counter--,showQuestion(counter)},nextQuestion=e=>{if(!validateQuestion())return!1;questions[e].classList.remove("active"),counter++,showQuestion(counter)},startButton.addEventListener("click",(()=>{counter++,showQuestion(counter)})),prevButton.addEventListener("click",(()=>{prevQuestion(counter)})),nextButton.addEventListener("click",(()=>{nextQuestion(counter)})),startOverButton.addEventListener("click",(()=>{location.reload()})),submitButton.addEventListener("click",(e=>{if(e.preventDefault(),!validateSummary())return!1;fetch("submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(finalData)}).then((e=>e.json())).then((e=>{console.log("Success:",e)})).catch((e=>{console.log("Error:",e)})),showSubmission(finalData),prevButton.classList.add("hidden"),nextButton.classList.add("hidden"),submitButton.classList.add("hidden"),progress.classList.add("hidden"),startOverButton.classList.remove("hidden"),localStorage.clear()})),validateEmail=e=>/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase()),validateQuestion=()=>{let e=!0,t={};counter<questions.length-1&&(t.question=counter);let a=questions[counter].querySelector(".form-element");if(questions[counter].classList.contains("radio-group")){t.type="radio",t.name="frequency";let a=document.querySelector('input[name="frequency"]:checked');null!=a?t.value=a.value:(e=!1,alert("Please select an option"))}else questions[counter].classList.contains("select-group")?(t.type="select",t.name="class",""===a.value?(e=!1,alert("Please select an option")):t.value=a.value):(t.type=a.type,t.name=a.name,""===a.value?(e=!1,a.classList.add("error"),alert("Please fill out this field")):"email"===t.type?validateEmail(a.value)?t.value=a.value:(e=!1,a.classList.add("error"),alert("Please enter a valid email")):(a.classList.remove("error"),t.value=a.value));return e&&(formData[t.question]=t,localStorage.setItem("data",JSON.stringify(formData))),e},validateSummary=()=>{let e=!0,t=Array.from(questions[counter].querySelectorAll("section.summary-section"));return finalData=[],t.forEach(((t,a)=>{if(t.classList.contains("radio-group")){let n=t.querySelector('input[name="ffrequency"]:checked');null!=n?finalData.push({question:a,type:"radio",name:"frequency",value:n.value}):(e=!1,alert("Please fill out all required fields"))}else if(t.classList.contains("select-group")){let n=t.querySelector("select");""===n.value?(e=!1,alert("Please fill out all required fields")):finalData.push({question:a,type:"select",name:"class",value:n.value})}else{let n=t.querySelector(".form-element");""===n.value?(e=!1,n.classList.add("error"),alert("Please fill out all required fields")):"email"===n.type?validateEmail(n.value)?finalData.push({question:a,type:n.type,name:n.name,value:n.value}):(e=!1,n.classList.add("error"),alert("Please enter a valid email")):(n.classList.remove("error"),finalData.push({question:a,type:n.type,name:n.name,value:n.value}))}})),e&&localStorage.setItem("data",JSON.stringify(finalData)),e};